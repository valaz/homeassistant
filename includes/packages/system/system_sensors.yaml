system_sensors:
  recorder:
    db_url: !secret db_link
    purge_keep_days: 7
    auto_purge: true
    exclude:
      domains:
        - camera
      entity_globs:
        - sensor.docker_*
        - switch.docker_*
        - sensor.uptimekuma_*
        - binary_sensor.uptimekuma_*
  #   include:
  #     entities:
  #       - binary_sensor.rpi_power_status
  #       - sensor.processor_use
  #       - sensor.disk_use_percent
  #       - sensor.memory_use_percent
  #       - sensor.disk_free
  #       - sensor.processor_temperature
  #       - sensor.home_assistant_v2_db
  #       - sensor.maria_db

  homeassistant:
    customize:
      sensor.processor_use:
        friendly_name: Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ñ€Ð°
      sensor.disk_use_percent:
        friendly_name: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¸ÑÐºÐ°
      sensor.disk_free:
        friendly_name: Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾ Ð½Ð° Ð´Ð¸ÑÐºÐµ
      sensor.processor_temperature:
        friendly_name: Ð¢ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ñ€Ð°
      sensor.memory_use_percent:
        friendly_name: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐžÐ—Ð£
      sensor.home_assistant_v2_db:
        friendly_name: ÐžÐ±ÑŠÐµÐ¼ Ð±Ð°Ð·Ñ‹ HA
      sensor.maria_db:
        friendly_name: ÐžÐ±ÑŠÐµÐ¼ Ð±Ð°Ð·Ñ‹ Maria DB
      sensor.online_custom:
        friendly_name: Home Assistant Ð² Ð¾Ð½Ð»Ð°Ð¹Ð½Ðµ
      sensor.last_boot_custom:
        friendly_name: Ð¡ÐµÑ€Ð²ÐµÑ€ Ð² Ð¾Ð½Ð»Ð°Ð¹Ð½Ðµ
      sensor.custom_time:
        friendly_name: Ð¢ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ

  alert:
    hulk_high_disk_usage:
      name: "Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð¸ÑÐºÐ° Ð½Ð° Hulk"
      message: "âš ï¸ðŸ’¾ Ð’Ñ‹ÑÐ¾ÐºÐ¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¸ÑÐºÐ° Ð½Ð° Hulk: {{ states('sensor.disk_use_percent') }}%"
      done_message: "âœ…ðŸ’¾ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¸ÑÐºÐ° Ð½Ð° Hulk ÑÐ½Ð¸Ð·Ð¸Ð»Ð¾ÑÑŒ: {{ states('sensor.disk_use_percent') }}%"
      entity_id: binary_sensor.c_hulk_high_disk_usage
      state: "on"
      repeat: 60
      can_acknowledge: true
      skip_first: false
      notifiers:
        - tg_valaz

  binary_sensor:
    - platform: template
      sensors:
        c_hulk_high_disk_usage:
          friendly_name: "Hulk Dish High Usage"
          value_template: >-
            {{ states('sensor.disk_use_percent') | float > 85 }}

  sensor:
    - platform: template
      sensors:
        c_uptime_server:
          friendly_name: "Server Uptime"
          icon_template: mdi:clock-time-two-outline
          value_template: >
            {% set uptime_seconds = (now() - (states('sensor.last_boot') | as_datetime)).total_seconds() %}
            {{ timedelta(seconds=uptime_seconds) }}
        c_uptime_system:
          friendly_name: "System Uptime"
          icon_template: mdi:clock-time-two-outline
          value_template: >
            {% set uptime_seconds = (now() - (states('sensor.online') | as_datetime)).total_seconds() %}
            {{ timedelta(seconds=uptime_seconds) }}

    - platform: time_date
      display_options:
        - "time"
        - "date"
        - "date_time"
        - "time_date"

  template:
    - trigger:
        - platform: time_pattern
          seconds: "/30"
      sensor:
        - name: time_1_sec
          state: "{{ as_timestamp(now()) | round(default=0)}}"

    - sensor:
        - name: custom_time
          state: >
            {{states("sensor.time_1_sec") | int | timestamp_custom("%H:%M:%S") }}
        # Ð’Ñ€ÐµÐ¼Ñ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Home Assistant
        - name: online_custom
          state: >
            {% set s = (states("sensor.time_1_sec") | int - as_timestamp(states('sensor.online')) | int) %}
            {{ '{:d} Ð´Ð½. {:02d}:{:02d}:{:02d}'.format (s // 86400, s % 86400 // 3600, s % 3600 // 60, s % 60) }}

        # Ð’Ñ€ÐµÐ¼Ñ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð°
        - name: last_boot_custom
          state: >
            {% set s = (states("sensor.time_1_sec") | int - as_timestamp(states('sensor.last_boot')) | int) %}
            {{ '{:d} Ð´Ð½. {:02d}:{:02d}:{:02d}'.format (s // 86400, s % 86400 // 3600, s % 3600 // 60, s % 60) }}
