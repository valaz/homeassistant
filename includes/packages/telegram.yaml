telegram:
  sensor:
    - platform: template
      sensors:
        unavailable_now_light:
          friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤ - "
          value_template: "{{states.light | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
          icon_template: mdi:counter

        unavailable_now_switch:
          friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–ª–µ - "
          value_template: "{{states.switch | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
          icon_template: mdi:counter

        unavailable_now_sensor:
          friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ - "
          value_template: "{{states.sensor | selectattr ('state', 'equalto', 'unavailable') | list | length - 1 }}"
          icon_template: mdi:counter

        unavailable_now_binary_sensor:
          friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ - "
          value_template: "{{states.binary_sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
          icon_template: mdi:counter

  script:
    tg_simple_message:
      alias: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      sequence:
        - service: notify.tg_valaz
          data:
            message: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è - {{ states('sensor.time') }} . –í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ"

    tg_system_report:
      alias: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã
      sequence:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F4BB"}} –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
              {{"\U0001F567"}} –û—Ç—á–µ—Ç –∑–∞ {{ states('sensor.time_date') }}
              {{"\U0001F4A1"}} –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_light') }} 
              {{"\U0001F50C"}} –°–≤–∏—á–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_switch') }} 
              {{"\U0001F321"}} –°–µ–Ω—Å–æ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_sensor') }} 
              {{"\U0001F51F"}} –ë–∏–Ω–∞—Ä–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_binary_sensor') }}

    tg_climate_report:
      alias: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–ª–∏–º–∞—Ç–∞
      sequence:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F333"}} –ö–ª–∏–º–∞—Ç –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ
              {{"\U0001F567"}} –û—Ç—á–µ—Ç –∑–∞ {{ states('sensor.time_date') }}
              {{"\U0001F4FA"}} –ì–æ—Å—Ç–∏–Ω–∞—è - {{ states('sensor.c_livingroom_temperature') }} ¬∞C, {{ states('sensor.c_livingroom_humidity') }} %
              {{"\U0001F468"}} –°–ø–∞–ª—å–Ω—è - {{ states('sensor.c_bedroom_temperature') }} ¬∞C, {{ states('sensor.c_bedroom_humidity') }} %, {{ states('sensor.c_bedroom_co2_density') }} ppm
              {{"\U0001F476"}} –î–µ—Ç—Å–∫–∞—è - {{ states('sensor.c_kidsroom_temperature') }} ¬∞C, {{ states('sensor.c_kidsroom_humidity') }} %
              {{"\U0001F487"}} –í–∞–Ω–Ω–∞—è - {{ states('sensor.c_bathroom_temperature') }} ¬∞C, {{ states('sensor.c_bathroom_humidity') }} %

    tg_homelab_report:
      alias: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ homelab
      sequence:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U00002699"}} Homelab
              {{"\U0001F567"}} –û—Ç—á–µ—Ç –∑–∞ {{ states('sensor.time_date') }}
              {{"\U00002600"}} Hulk CPU Temp - {{ states('sensor.glances_package_id_0_temperature') }} ¬∞C

    tg_people_report:
      alias: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ people
      sequence:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F3E0"}} –õ—é–¥–∏
              {{"\U0001F468"}} {% if is_state('binary_sensor.azat_at_home', 'on') %}–ê–∑–∞—Ç –¥–æ–º–∞{% else %}–ê–∑–∞—Ç –ù–ï –¥–æ–º–∞{% endif %}
              {{"\U0001F469"}} {% if is_state('binary_sensor.elia_at_home', 'on') %}–≠–ª–∏—è –¥–æ–º–∞{% else %}–≠–ª–∏—è –ù–ï –¥–æ–º–∞{% endif %}
  # https://apps.timwhitlock.info/emoji/tables/unicode
  automation:
    - alias: "[Telegram] –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç–∞"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/start"
      action:
        - service: notify.tg_valaz
          data:
            message: "commands"
            data:
              keyboard:
                - "/report, /homelab"
                - "/climate, /people"
                - "/open_intercom"

    - alias: "[Telegram] Report"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/report"
      action:
        - service: script.turn_on
          entity_id:
            - script.tg_system_report

    - alias: "[Telegram] Climate"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/climate"
      action:
        - service: script.turn_on
          entity_id:
            - script.tg_climate_report

    - alias: "[Telegram] Homelab"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/homelab"
      action:
        - service: script.turn_on
          entity_id:
            - script.tg_homelab_report

    - alias: "[Telegram] People Report"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/people"
      action:
        - service: script.turn_on
          entity_id:
            - script.tg_people_report

    - alias: "[Telegram] Open Intercom"
      initial_state: true
      trigger:
        - platform: event
          event_type: telegram_command
          event_data:
            command: "/open_intercom"
      action:
        - service: lock.unlock
          entity_id:
            - lock.intercom_door

    - alias: "[Telegram] Roborock –Ω–∞—á–∞–ª —É–±–æ—Ä–∫—É"
      initial_state: true
      trigger:
        - platform: state
          entity_id: vacuum.roborock_s5
          from: "docked"
          to: "cleaning"
      action:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F9F9"}} –ü—ã–ª–µ—Å–æ—Å –Ω–∞—á–∞–ª —É–±–æ—Ä–∫—É ({{state_attr('vacuum.roborock_s5', 'status')}}).

    - alias: "[Telegram] Roborock –∑–∞–≤–µ—Ä—à–∏–ª —É–±–æ—Ä–∫—É"
      initial_state: true
      trigger:
        - platform: state
          entity_id: vacuum.roborock_s5
          from: "returning"
          to: "docked"
      action:
        - service: script.roborock_s5_map_to_telegram
        - service: script.reset_zone_selection
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F9F9"}} –ü—ã–ª–µ—Å–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª —É–±–æ—Ä–∫—É.
              {{"\U0001F3E0"}} –ü–ª–æ—â–∞–¥—å —É–±–æ—Ä–∫–∏ - {{ states('sensor.roborock_s5_last_clean_area') }} m2.
              {{"\U000023F1"}} –í—Ä–µ–º—è —É–±–æ—Ä–∫–∏ - {{ states('sensor.c_roborock_s5_last_clean_duration') }} –º–∏–Ω.
              {{"\U0001F50B"}} –£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞ - {{ states('sensor.c_roborock_s5_battery') }} %.

    - alias: "[Telegram] Roborock –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–±–æ—Ä–∫–µ"
      initial_state: true
      trigger:
        - platform: state
          entity_id: vacuum.roborock_s5
          to: "error"
      action:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F9F9"}} –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–±–æ—Ä–∫–µ.
              {{"\U000026A0"}} {{state_attr('vacuum.roborock_s5', 'error')}}

    - alias: "[Telegram] Macbook Pro 15 Network State Alert"
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.macbook_pro_15_ping
          from: "on"
          to: "off"
        - platform: state
          entity_id: binary_sensor.macbook_pro_15_ping
          from: "off"
          to: "on"
      action:
        - service: notify.tg_valaz
          data:
            message: |
              {{"\U0001F4BB"}} {{ states('sensor.time_date') }} –°–æ—Å—Ç–æ—è–Ω–∏–µ Macbook Pro 15 –≤ —Å–µ—Ç–∏: {{states('binary_sensor.macbook_pro_15_ping')}}

    - alias: "[Telegram] Jubilee is ready for Rocket League"
      initial_state: true
      trigger:
        - platform: state
          entity_id: binary_sensor.c_signal_rocketleague_jubilee
          to: "on"
      action:
        - service: notify.tg_valaz
          data:
            message: |
              üèéÔ∏è –Æ–±–∏–ª–µ–π –≥–æ—Ç–æ–≤ –∫ –†–õ!
